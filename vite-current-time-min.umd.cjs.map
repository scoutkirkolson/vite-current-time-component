{"version":3,"file":"vite-current-time-min.umd.cjs","sources":["../plugin-vue:export-helper","../src/components/CurrentTime.ce.vue","../src/build.umd.ts"],"sourcesContent":["\nexport default (sfc, props) => {\n  const target = sfc.__vccOpts || sfc;\n  for (const [key, val] of props) {\n    target[key] = val;\n  }\n  return target;\n}\n","<template>\n  <div class=\"current-time-component\" :id=\"id\">\n    <slot name=\"prefix\" />\n    {{ displayTime }} ...\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, computed, watch, onMounted } from 'vue';\n\nconst props = defineProps({\n  id: {\n    type: String,\n    default: '',\n  },\n  timeZone: {\n    type: String,\n    default: 'Europe/Amsterdam',\n  },\n});\n\nconst emit = defineEmits(['datechange']);\n\nconst currentDateTime = ref(new Date());\nconst currentTimeZone = ref(props.timeZone);\n\nconsole.log('props', props)\n\nconst displayTime = computed(() =>\n  currentDateTime.value.toLocaleString('nl-NL', {\n    timeZone: currentTimeZone.value || 'Europe/Amsterdam',\n  })\n);\n\nfunction changeTimeZone(event) {\n  console.log('changeTimeZone', event.detail)\n  currentTimeZone.value = event.detail?.timeZone || 'Europe/Amsterdam'\n}\n\nfunction listenEvents() {\n  console.log('listenEvents', props)\n  document\n    .querySelector(props.id ? ('#' + props.id) : 'current-time')\n    .addEventListener('timezonechange', changeTimeZone)\n  //document.addEventListener('timezonechange', changeTimeZone)\n}\n\nonMounted(listenEvents)\n\nsetInterval(() => {\n  currentDateTime.value = new Date();\n  emit('datechange', displayTime);\n}, 1000);\n</script>\n\n<style>\n.current-time-component {\n  color: purple;\n}\n</style>\n","import CurrentTime from './components/CurrentTime.ce.vue'\nimport { createApp, h, reactive } from 'vue'\n\nconst createCustomEvent = (name: string, args: any = []) => {\n  return new CustomEvent(name, {\n    bubbles: false,\n    composed: true,\n    cancelable: false,\n    detail: !args.length\n      ? self\n      : args.length === 1\n      ? args[0]\n      : args\n  });\n};\n\nclass VueCustomComponent extends HTMLElement {\n  private _def: any;\n  private _props = reactive<Record<string, any>>({});\n  private _numberProps: string[];\n\n  constructor() {\n    super()\n\n    this._numberProps = [];\n    this._def = CurrentTime;\n  }\n\n  // Helper function to set the props based on the element's attributes (for primitive values) or properties (for arrays & objects)\n  private setAttr(attrName: string) {\n    // @ts-ignore\n    let val: string | number | null = this[attrName] || this.getAttribute(attrName);\n\n    if (val !== undefined && this._numberProps.includes(attrName)) {\n      val = Number(val);\n    }\n\n    console.log('prop:' + attrName +'=' + val);\n\n    this._props[attrName] = val;\n  }\n\n  // Mutation observer to handle attribute changes, basically two-way binding\n  private connectObserver() {\n    return new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        if (mutation.type === \"attributes\") {\n          const attrName = mutation.attributeName as string;\n\n          this.setAttr(attrName);\n        }\n      });\n    });\n  }\n\n  // Make emits available at the parent element\n  private createEventProxies() {\n    const eventNames = this._def.emits as string[];\n\n    if (eventNames) {\n      eventNames.forEach(evName => {\n        const handlerName = `on${evName[0].toUpperCase()}${evName.substring(1)}`;\n\n        this._props[handlerName] = (...args: any[]) => {\n          this.dispatchEvent(createCustomEvent(evName, args));\n        };\n      });\n    }\n  }\n\n  // Create the application instance and render the component\n  private createApp() {\n    const self = this;\n\n    const app = createApp({\n      render() {\n        return h(self._def, self._props);\n      }\n    })\n      // USE ANYTHING YOU NEED HERE\n\n    app.mount(this);\n  }\n\n  // Handle element being inserted into DOM\n  connectedCallback() {\n    const componentProps = Object.entries(CurrentTime.props);\n\n    componentProps.forEach(([propName, propDetail]) => {\n      // @ts-ignore\n      if (propDetail.type === Number) {\n        this._numberProps.push(propName);\n      }\n\n      console.log(propName);\n\n      this.setAttr(propName);\n    });\n\n    this.createEventProxies();\n    this.createApp();\n    this.connectObserver().observe(this, { attributes: true });\n  }\n}\n\n// Register as custom element\ncustomElements.define('current-time', VueCustomComponent);\n"],"names":["_export_sfc","sfc","props","target","key","val","currentDateTime","ref","currentTimeZone","displayTime","computed","changeTimeZone","event","listenEvents","vue","emit","createCustomEvent","name","args","VueCustomComponent","reactive","CurrentTime","attrName","mutations","mutation","eventNames","evName","handlerName","self","createApp","h","propName","propDetail"],"mappings":";EACAA,EAAe,CAACC,EAAKC,IAAU,CAC7B,MAAMC,EAASF,EAAI,WAAaA,EAChC,SAAW,CAACG,EAAKC,CAAG,IAAKH,EACvBC,EAAOC,CAAG,EAAIC,EAEhB,OAAOF,CACT,+KCgBMG,EAAkBC,EAAG,IAAC,IAAI,IAAM,EAChCC,EAAkBD,EAAG,IAACL,EAAM,QAAQ,EAE1C,QAAQ,IAAI,QAASA,CAAK,EAE1B,MAAMO,EAAcC,EAAAA,SAAS,IAC3BJ,EAAgB,MAAM,eAAe,QAAS,CAC5C,SAAUE,EAAgB,OAAS,kBACvC,CAAG,CACH,EAEA,SAASG,EAAeC,EAAO,CAC7B,QAAQ,IAAI,iBAAkBA,EAAM,MAAM,EAC1CJ,EAAgB,MAAQI,EAAM,QAAQ,UAAY,kBACpD,CAEA,SAASC,GAAe,CACtB,QAAQ,IAAI,eAAgBX,CAAK,EACjC,SACG,cAAcA,EAAM,GAAM,IAAMA,EAAM,GAAM,cAAc,EAC1D,iBAAiB,iBAAkBS,CAAc,CAEtD,CAES,OAAAG,EAAA,UAACD,CAAY,EAEtB,YAAY,IAAM,CAChBP,EAAgB,MAAQ,IAAI,KAC5BS,EAAK,aAAcN,CAAW,CAChC,EAAG,GAAI,uNCjDDO,EAAoB,CAACC,EAAcC,EAAY,KAC5C,IAAI,YAAYD,EAAM,CAC3B,QAAS,GACT,SAAU,GACV,WAAY,GACZ,OAASC,EAAK,OAEVA,EAAK,SAAW,EAChBA,EAAK,CAAC,EACNA,EAHA,IAGA,CACL,EAGH,MAAMC,UAA2B,WAAY,CAK3C,aAAc,CACN,QAJA,KAAA,OAASC,WAA8B,CAAA,CAAE,EAM/C,KAAK,aAAe,GACpB,KAAK,KAAOC,CACd,CAGQ,QAAQC,EAAkB,CAEhC,IAAIjB,EAA8B,KAAKiB,CAAQ,GAAK,KAAK,aAAaA,CAAQ,EAE1EjB,IAAQ,QAAa,KAAK,aAAa,SAASiB,CAAQ,IAC1DjB,EAAM,OAAOA,CAAG,GAGlB,QAAQ,IAAI,QAAUiB,EAAU,IAAMjB,CAAG,EAEpC,KAAA,OAAOiB,CAAQ,EAAIjB,CAC1B,CAGQ,iBAAkB,CACjB,OAAA,IAAI,iBAA8BkB,GAAA,CACvCA,EAAU,QAAoBC,GAAA,CACxB,GAAAA,EAAS,OAAS,aAAc,CAClC,MAAMF,EAAWE,EAAS,cAE1B,KAAK,QAAQF,CAAQ,CACvB,CAAA,CACD,CAAA,CACF,CACH,CAGQ,oBAAqB,CACrB,MAAAG,EAAa,KAAK,KAAK,MAEzBA,GACFA,EAAW,QAAkBC,GAAA,CACrB,MAAAC,EAAc,KAAKD,EAAO,CAAC,EAAE,YAAa,CAAA,GAAGA,EAAO,UAAU,CAAC,CAAC,GAEtE,KAAK,OAAOC,CAAW,EAAI,IAAIT,IAAgB,CAC7C,KAAK,cAAcF,EAAkBU,EAAQR,CAAI,CAAC,CAAA,CACpD,CACD,CAEL,CAGQ,WAAY,CAClB,MAAMU,EAAO,KAEDC,EAAAA,UAAU,CACpB,QAAS,CACP,OAAOC,EAAEF,EAAAA,EAAK,KAAMA,EAAK,MAAM,CACjC,CAAA,CACD,EAGG,MAAM,IAAI,CAChB,CAGA,mBAAoB,CACK,OAAO,QAAQP,EAAY,KAAK,EAExC,QAAQ,CAAC,CAACU,EAAUC,CAAU,IAAM,CAE7CA,EAAW,OAAS,QACjB,KAAA,aAAa,KAAKD,CAAQ,EAGjC,QAAQ,IAAIA,CAAQ,EAEpB,KAAK,QAAQA,CAAQ,CAAA,CACtB,EAED,KAAK,mBAAmB,EACxB,KAAK,UAAU,EACf,KAAK,kBAAkB,QAAQ,KAAM,CAAE,WAAY,GAAM,CAC3D,CACF,CAGA,eAAe,OAAO,eAAgBZ,CAAkB"}